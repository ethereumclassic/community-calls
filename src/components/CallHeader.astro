---
import type { Call } from "../lib/types";
import { Icon } from "astro-icon/components";
import TimezoneBar from "./TimezoneBar.astro";
import GreenRoom from "./GreenRoom.astro";
import UpcomingBadge from "./UpcomingBadge.astro";
import LiveBadge from "./LiveBadge.astro";
import { formatFullDate } from "../lib/dates";

interface Props {
  call: Call;
}

const { call } = Astro.props;

const callNumber = call.data.callNumber!;
const isUpcoming = call.data.isUpcoming;
const joinModalId = `join-call-modal-${callNumber}`;
---

<header class="mb-10">
  <!-- Status badge -->
  <div class="flex items-center gap-3 mb-8 h-[26px]">
    {
      call.data.youtube ? (
        <LiveBadge color="green">Recorded</LiveBadge>
      ) : (
        isUpcoming &&
        call.data.eventDateTime && (
          <UpcomingBadge eventDateTime={call.data.eventDateTime} />
        )
      )
    }
  </div>

  <!-- Title -->
  {
    callNumber !== 0 && (
      <p class="text-base md:text-lg font-mono text-gray-400 mb-4">
        Ethereum Classic Community Call #{callNumber}
      </p>
    )
  }
  <h1 class="font-display text-6xl md:text-6xl text-white mb-4">
    {call.data.description}
  </h1>
  <!-- Meta info -->
  <div class="text-base md:text-lg font-mono text-gray-400 mb-8">
    {formatFullDate(call.data.date)}
  </div>

  <!-- Timezone Display -->
  {call.data.time && <TimezoneBar time={call.data.time} />}

  <!-- Join Call Button & Green Room (only for upcoming calls with both) -->
  {
    isUpcoming &&
      call.data.joinLink &&
      !call.data.youtube &&
      call.data.greenRoom && (
        <div class="mt-6 flex flex-col md:flex-row md:items-center gap-4">
          <a
            href={call.data.joinLink}
            data-modal-trigger={joinModalId}
            class="flex md:inline-flex items-center justify-center gap-5 px-6 py-4 bg-etc-green text-void font-mono text-base font-semibold uppercase tracking-wider rounded-lg hover:bg-etc-green/90 transition-colors whitespace-nowrap cursor-pointer"
          >
            <Icon name="lucide:phone" class="icon-lg" />
            Join Call
            <br class="hidden md:inline" />
            on {call.data.location}
          </a>
          <GreenRoom
            time={call.data.greenRoom.time}
            location={call.data.greenRoom.location}
            joinLink={call.data.greenRoom.joinLink}
          />
        </div>
      )
  }

</header>
