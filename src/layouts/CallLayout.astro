---
import type { Call } from "../lib/types";
import PageLayout from "./PageLayout.astro";
import AnimatedContainer from "../components/AnimatedContainer.astro";
import CallNavigation from "../components/CallNavigation.astro";
import CallHeader from "../components/CallHeader.astro";
import YouTubeEmbed from "../components/YouTubeEmbed.astro";
import JoinCallModal from "../components/JoinCallModal.astro";
import { formatShortDate, formatTime, getTimezoneDateNote } from "../lib/dates";
// import HostList from "../components/HostList.astro";

interface Props {
  call: Call;
  prevCall?: Call | null;
  nextCall?: Call | null;
  upcomingCall?: Call | null;
}

const { call, prevCall, nextCall, upcomingCall } = Astro.props;

const callNumber = call.data.callNumber!;
const youtubeId = call.data.youtubeId;
const isUpcoming = call.data.isUpcoming;
const joinModalId = `join-call-modal-${callNumber}`;

const title = call.data.description
  ? `Call ${callNumber} - ${call.data.description}`
  : `Call ${callNumber}`;
const timezoneNote = getTimezoneDateNote(call.data.date, call.data.time);
const ogDescription = `${formatShortDate(call.data.date)} at ${formatTime(call.data.time)}${timezoneNote}`;
---

<PageLayout title={title} description={ogDescription} maxWidth="narrow">
  <AnimatedContainer as="article" delay={100}>
    <CallNavigation
      prevCall={prevCall}
      nextCall={nextCall}
      currentCall={call}
      upcomingCall={upcomingCall}
    />

    <CallHeader call={call} />

    {
      youtubeId && (
        <YouTubeEmbed
          youtubeId={youtubeId}
          date={call.data.date}
          callNumber={callNumber}
          title={title}
        />
      )
    }

    <!-- Hosts - temporarily hidden
    {call.data.hosts && call.data.hosts.length > 0 && (
      <HostList hosts={call.data.hosts} />
    )}
    -->

    <!-- Main Content -->
    <AnimatedContainer
      as="section"
      delay={400}
      class="prose md:prose-lg prose-invert max-w-none"
    >
      <slot />
    </AnimatedContainer>
  </AnimatedContainer>

  <!-- Join Call Modal (rendered at root level for proper backdrop) -->
  {
    isUpcoming && call.data.joinLink && !call.data.youtube && (
      <JoinCallModal slot="modals" call={call} modalId={joinModalId} />
    )
  }
</PageLayout>
