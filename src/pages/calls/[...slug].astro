---
import { render } from "astro:content";
import CallLayout from "../../layouts/CallLayout.astro";
import { getCalls, sortCallsByNumber } from "../../lib/calls";

export async function getStaticPaths() {
  const allCalls = await getCalls();

  // Regular calls get prev/next navigation
  const regularCalls = allCalls.filter((call) => !call.data.special);
  const sortedRegularCalls = sortCallsByNumber(regularCalls);

  // Generate paths for all calls
  const allPaths = allCalls.map((call) => {
    // Only regular calls get prev/next navigation
    if (call.data.special) {
      return {
        params: { slug: call.data.slug },
        props: { call, prevCall: null, nextCall: null },
      };
    }

    const index = sortedRegularCalls.findIndex((c) => c.id === call.id);
    return {
      params: { slug: call.data.slug },
      props: {
        call,
        prevCall: index > 0 ? sortedRegularCalls[index - 1] : null,
        nextCall:
          index < sortedRegularCalls.length - 1
            ? sortedRegularCalls[index + 1]
            : null,
      },
    };
  });

  return allPaths;
}

const { call, prevCall, nextCall } = Astro.props;
const { Content } = await render(call);
---

<CallLayout call={call} prevCall={prevCall} nextCall={nextCall}>
  <Content />
</CallLayout>
